import { useCallback, useContext } from 'react';
import { AdapterContext } from '../contexts/AdapterContext';

export const useMakeCall = (webexCrosslaunchtoken: string) => {
  const ctx = useContext(AdapterContext);

  const makeCall = useCallback(
    (address: string, isVideo?: boolean) => {
      return makeCrossLaunchCall(address, !!isVideo, webexCrosslaunchtoken);
    },
    [makeCrossLaunchCall]
  );

  return [makeCall];
};

export async function makeCrossLaunchCall(address: string, isAudio = false, webexCrosslaunchtoken: string) {
  console.debug(
    `Making ${!isAudio ? 'audio' : 'video'} call to address ${address}`
  );
  const url = `webextel://${address}`;
  //const crossLaunchCallToken = await getCrossLaunchToken();
  const callUrl = new URL(url);

  // TODO: add check for mobile and if audio calls are enabled
  callUrl.searchParams.append('jws', webexCrosslaunchtoken);
  callUrl.searchParams.append('isAudio', String(!isAudio));
  window.open(callUrl.href);
}
